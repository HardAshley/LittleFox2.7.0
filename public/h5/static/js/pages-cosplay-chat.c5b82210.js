(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-cosplay-chat"],{"0d9d":function(t,e,i){"use strict";i.r(e);var a=i("bf00"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},"5b1a":function(t,e,i){"use strict";var a=i("f659"),n=i.n(a);n.a},"5f66":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticStyle:{height:"100%"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideCopyBtn.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"page"},[t.lists&&t.lists.length>0?i("v-uni-scroll-view",{staticClass:"box-msg-list",attrs:{"scroll-x":!1,"scroll-y":!0,"scroll-with-animation":!1,"scroll-top":t.scrollTop}},[i("v-uni-view",{staticClass:"list"},[t._l(t.lists,(function(e,a){return["AI"==e.user?i("v-uni-view",{key:a+"_0",staticClass:"message",staticStyle:{background:"#f7f7f8"},attrs:{"data-index":a}},[i("v-uni-view",{staticClass:"avatar"},[i("img",{attrs:{mode:"widthFix",src:"/static/img/ic_ai.png"}})]),i("v-uni-view",{staticClass:"text markdown-body"},[i("textComponent",{attrs:{text:e.message}}),i("v-uni-view",{staticClass:"tools"},[i("v-uni-view",[i("v-uni-view",{staticClass:"btn",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.copyText(e.message)}}},[i("v-uni-image",{staticClass:"icon",attrs:{src:"/static/images/ic_copy.png"}}),i("span",[t._v(t._s(t._f("lang")("复制内容")))])],1)],1),i("v-uni-view",[i("v-uni-view",{staticClass:"btn",staticStyle:{"margin-right":"0"},attrs:{title:t._f("lang")("重新回答")},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.retry(a-1)}}},[i("v-uni-image",{staticClass:"icon",attrs:{src:"/static/images/ic_retry.png"}})],1)],1)],1)],1)],1):i("v-uni-view",{staticClass:"message",staticStyle:{background:"#fff"}},[i("v-uni-view",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[i("img",{attrs:{mode:"widthFix",src:t.userAvatar}})]),i("v-uni-view",{staticClass:"text markdown-body",attrs:{"data-text":e.message},on:{longpress:function(e){arguments[0]=e=t.$handleEvent(e),t.showCopyBtn.apply(void 0,arguments)}}},[i("textComponent",{attrs:{text:e.message}})],1)],1)]})),t.writing||t.writingText?i("v-uni-view",{staticClass:"message",staticStyle:{background:"#f7f7f8"}},[i("v-uni-view",{staticClass:"avatar"},[i("img",{attrs:{src:"/static/img/ic_ai.png"}})]),i("v-uni-view",{staticClass:"text markdown-body"},[i("textComponent",{attrs:{text:t.writingText,writing:!(!t.writing&&!t.writingText)}}),i("v-uni-view",{staticClass:"tools"},[i("v-uni-view",[i("v-uni-view",{staticClass:"btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.stopFetch.apply(void 0,arguments)}}},[i("v-uni-image",{staticClass:"icon",attrs:{src:"/static/images/ic_stop.png"}}),i("span",[t._v(t._s(t._f("lang")("停止回复")))])],1)],1)],1)],1)],1):t._e(),i("v-uni-view",{staticClass:"btn-copy",style:"left:"+t.copyBtnLeft+"px;top:"+t.copyBtnTop+"px;",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.copyText(t.copyBtnText)}}},[t._v(t._s(t._f("lang")("复制")))])],2)],1):i("v-uni-scroll-view",{staticClass:"box-msg-list",staticStyle:{background:"#f7f7f8"},attrs:{"scroll-x":!1,"scroll-y":!0,"scroll-with-animation":!1}},[i("welcome",{attrs:{module:"cosplay",title:t.welcomeTitle,desc:t.welcomeDesc,tips:t.welcomeTips},on:{use:function(e){arguments[0]=e=t.$handleEvent(e),t.quickMessage.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"box-input"},[i("v-uni-view",{staticClass:"input"},[i("v-uni-textarea",{attrs:{type:"text","confirm-type":"send","auto-height":!0,placeholder:t.role.hint||"输入你的问题",maxlength:"3000","cursor-spacing":"0"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.sendConfirm.apply(void 0,arguments)},focus:function(e){arguments[0]=e=t.$handleEvent(e),t.inputFocus.apply(void 0,arguments)}},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),i("v-uni-button",{staticClass:"btn-send",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendText.apply(void 0,arguments)}}},[i("v-uni-image",{attrs:{mode:"widthFix",src:"/static/images/ic_send.png"}})],1)],1)],1)],1)],1)},n=[]},"9c67":function(t,e,i){"use strict";i.r(e);var a=i("5f66"),n=i("0d9d");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("5b1a");var s=i("f0c5"),r=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,"85db5e56",null,!1,a["a"],void 0);e["default"]=r.exports},bf00:function(t,e,i){"use strict";i("7a82");var a=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("c7eb")),o=a(i("1da1"));i("ac1f"),i("5319"),i("498a"),i("14d9"),i("d3b7"),i("e9c4"),i("8a79"),i("c975"),i("e25e");var s=a(i("acd4")),r=a(i("4050"));i("45ab"),i("485c"),i("e1a1"),i("9283");var l=getApp(),c=[],d=0,u=null,g={components:{TextComponent:s.default,Welcome:r.default},data:function(){return{isLogin:!1,siteroot:"",lists:[],message:"",writingText:"",writing:!1,page:1,pagesize:10,scrollTop:0,role:{},role_id:0,copyBtnLeft:-200,copyBtnTop:0,copyBtnText:""}},computed:{welcomeTitle:function(){return this.role.title},welcomeDesc:function(){return this.role.welcome},welcomeTips:function(){return this.role.tips},userAvatar:function(){return this.userinfo&&this.userinfo.avatar?this.userinfo.avatar:"/static/img/ic_user.png"}},onLoad:function(t){var e=this;t.role_id?this.setData({role_id:t.role_id}):t.id&&this.setData({role_id:t.id}),this.setData({system:l.globalData.system,siteroot:l.globalData.siteroot.replace("/web.php","")}),this.getRole(),this.getHistoryMsg(),l.globalData.util.checkLogin().then((function(){e.setData({isLogin:!0}),e.getUserInfo()}))},methods:{inputFocus:function(){this.isLogin||l.globalData.util.toLogin("请登录")},sendText:function(){var t=this;return(0,o.default)((0,n.default)().mark((function e(){var i,a,o,s,r,g,f,p,b,v,h,m,x,w,y;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.writing){e.next=2;break}return e.abrupt("return");case 2:if(i=t.trim(t.message),i){e.next=12;break}if(!t.role.hint){e.next=9;break}t.message=t.role.hint,i=t.message,e.next=12;break;case 9:return l.globalData.util.message("请输入你的问题"),t.message="",e.abrupt("return");case 12:return d&&(clearInterval(d),d=0,c=[]),t.lists.push({user:"我",message:i}),t.message="",t.writing=!0,t.scrollToBottom(),a=new Headers,a.append("Content-Type","application/json"),a.append("X-site",uni.getStorageSync("sitecode")),o=t.siteroot+"/web.php/chat/sendText",s={role_id:t.role_id,message:i},u=new AbortController,e.next=25,fetch(o,{method:"POST",signal:u.signal,headers:a,body:JSON.stringify(s)});case 25:if(r=e.sent,r.ok){e.next=30;break}return t.writing=!1,l.globalData.util.message(r.statusText),e.abrupt("return");case 30:g=r.body.getReader(),f=new TextDecoder("utf-8"),p=!1,b="",d=setInterval((function(){c.length>0?(t.writingText+=c.shift(),t.scrollToBottom()):t.writing||(clearInterval(d),d=0,t.writingText&&t.lists.push({user:"AI",message:t.writingText}),t.writingText="",setTimeout((function(){t.scrollToBottom()}),200))}),20);case 35:if(p){e.next=56;break}return t.scrollToBottom(),e.next=39,g.read();case 39:if(v=e.sent,h=v.value,m=v.done,!h){e.next=53;break}if(x=f.decode(h),"\n"!==x||!b.endsWith("\n")){e.next=46;break}return e.abrupt("continue",35);case 46:if(!x){e.next=53;break}if(-1===x.indexOf("[error]")){e.next=51;break}if(w=function(){t.writing=!1,t.writingText="",t.lists.pop();var e=x.replace("[error]","");return-1!==e.indexOf("请登录")?l.globalData.util.message(e,"error",(function(){l.globalData.util.toLogin(e)})):-1!==e.indexOf("请充值")?l.globalData.util.message(e,"error",(function(){uni.navigateTo({url:"/pages/pay/vip"})})):l.globalData.util.message(e,"error"),"break"}(),"break"!==w){e.next=51;break}return e.abrupt("break",56);case 51:for(t.writing=!0,y=0;y<x.length;y++)c.push(x[y]);case 53:p=m,e.next=35;break;case 56:t.writing=!1;case 57:case"end":return e.stop()}}),e)})))()},stopFetch:function(){var t=this,e=this.writingText;this.writing=!1,u.abort(),setTimeout((function(){e||t.lists.pop()}),50)},retry:function(t){var e=this;uni.showModal({title:this.$lang("提示"),content:this.$lang("确定重新回答吗？"),confirmText:this.$lang("确定"),cancelText:this.$lang("取消"),success:function(i){i.confirm&&(e.message=e.lists[t].message,e.sendText())}})},sendConfirm:function(){var t=this;setTimeout((function(){t.sendText()}),50)},getHistoryMsg:function(){var t=this;l.globalData.util.request({url:"/chat/getHistoryMsg",data:{role_id:this.role_id,page:this.page,pagesize:this.pagesize}}).then((function(e){e.data.list.length>0&&(t.setData({lists:e.data.list}),setTimeout((function(){t.scrollToBottom()}),300))}))},quickMessage:function(t){this.message=t},getRole:function(){var t=this;l.globalData.util.request({url:"/cosplay/getRole",data:{role_id:this.role_id}}).then((function(e){t.setData({role:e.data}),document.title=e.data.title}))},scrollToBottom:function(){var t=this;setTimeout((function(){var e=uni.createSelectorQuery().in(t);e.select(".list").boundingClientRect((function(e){e&&t.setData({scrollTop:parseInt(e.height)})})),e.exec((function(t){}))}),200)},copyText:function(t){var e=document.createElement("textarea");e.value=t,e.readOnly="readOnly",e.style="width:0;height:0;",document.body.appendChild(e),e.select(),e.setSelectionRange(0,t.length),l.globalData.util.message("已复制"),document.execCommand("copy"),e.remove()},showCopyBtn:function(t){var e=this,i=uni.createSelectorQuery().in(this);i.select(".list").boundingClientRect((function(i){if(i){var a=parseInt(t.touches[0].pageX),n=parseInt(t.touches[0].pageY-i.top);n<0&&(n+=70),e.copyBtnLeft=a-30,e.copyBtnTop=n-60,e.copyBtnText=t.currentTarget.dataset.text}})),i.exec((function(t){}))},hideCopyBtn:function(){this.copyBtnLeft=-200,this.copyBtnText=""},trim:function(t){return t?t.replace(/(^\s*)|(\s*$)/g,""):""},getUserInfo:function(){var t=this;l.globalData.util.request({url:"/user/info",loading:!1}).then((function(e){t.setData({userinfo:e.data})})).catch((function(t){}))}}};e.default=g},ec86:function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,"uni-page-body[data-v-85db5e56]{background:#f7f7f8}body.?%PAGE?%[data-v-85db5e56]{background:#f7f7f8}.box-input[data-v-85db5e56]{width:100%;padding:%?40?% 0;left:0;bottom:0;border-top:1px solid #d8d8e2;background:#f6f9fc}.box-input .input[data-v-85db5e56]{width:%?690?%;margin:0 %?30?%;position:relative;box-sizing:border-box;box-shadow:0 0 %?12?% rgba(0,0,0,.1);background:#fefefe}.box-input .input uni-textarea[data-v-85db5e56]{width:%?580?%;padding:%?20?% %?10?% %?20?% %?20?%;border-radius:%?10?%;line-height:%?40?%;max-height:%?800?%;overflow-x:hidden;overflow-y:auto}.box-input .input .btn-send[data-v-85db5e56]{position:absolute;right:0;bottom:0;width:%?100?%;height:%?80?%;padding:0;border:none;border-radius:%?10?%;background:none;display:flex;align-items:center;justify-content:center;z-index:9}.box-input .input .btn-send[data-v-85db5e56]::after{display:none}.box-input .input .btn-send[data-v-85db5e56]:active{background:#f2f2f2}.box-input .input .btn-send uni-image[data-v-85db5e56]{width:%?40?%}.empty[data-v-85db5e56]{text-align:center;margin:0 %?60?%;padding:%?80?% 0 %?100?% 0;margin-top:%?200?%;background:#fff;border-radius:%?20?%}.empty uni-image[data-v-85db5e56]{width:%?404?%;height:%?266?%;margin-bottom:%?40?%}.empty .tip[data-v-85db5e56]{width:100%;line-height:%?40?%;font-size:%?32?%;letter-spacing:%?2?%;color:#444}.btn-finish[data-v-85db5e56]{width:60%;height:%?80?%;line-height:%?80?%;border-radius:%?48?%;border:none;color:#fff;margin:%?240?% auto 0 20%;box-shadow:0 0 %?20?% rgba(0,235,79,.1);font-size:%?30?%;letter-spacing:%?4?%;outline:none;background:#39b54a;text-align:center}.page[data-v-85db5e56]{width:100%;overflow:hidden;display:flex;flex-direction:column;position:absolute;left:0;right:0;top:0;bottom:0;background:#fff}.box-msg-list[data-v-85db5e56]{width:100%;height:100%;top:0;bottom:%?132?%;left:0;box-sizing:border-box;overflow:hidden}.list[data-v-85db5e56]{width:100%;height:auto}.message[data-v-85db5e56]{display:flex;justify-content:flex-start;padding:%?40?% %?40?%;border-bottom:%?2?% solid #eee}.message[data-v-85db5e56]:last-child{border-bottom:0}.message .text[data-v-85db5e56]{width:100%;color:#343541;line-height:%?52?%;font-size:%?32?%;word-break:break-all;padding:%?4?% 0;overflow:hidden}.message .text span[data-v-85db5e56]{display:inline}.message .avatar[data-v-85db5e56]{width:%?48?%;height:%?48?%;background:#10a37f;margin-right:%?30?%;color:#fff;font-size:%?28?%;border-radius:%?4?%;display:flex;align-items:center;justify-content:center;margin-top:%?6?%;overflow:hidden}.message .avatar uni-image[data-v-85db5e56],\n.message .avatar img[data-v-85db5e56]{width:%?48?%;height:%?48?%}.account[data-v-85db5e56]{margin:%?20?% %?30?%;padding:%?16?% %?24?% %?16?% %?24?%;box-sizing:border-box;\n\t/* background: #f3f6f9; */border-radius:%?10?%;display:flex;justify-content:space-between;align-items:center}.account .balance[data-v-85db5e56]{color:#666;font-size:%?24?%}.account .balance uni-text[data-v-85db5e56]{color:#10a37f;margin-right:%?6?%}.account .btn-pay[data-v-85db5e56]{display:inline-block;color:#10a37f;margin-left:%?20?%;font-size:%?24?%}.banner-ad[data-v-85db5e56]{width:100%;height:%?120?%;border-top:%?2?% solid #ddd}.content[data-v-85db5e56]{padding:%?20?%}.content uni-view[data-v-85db5e56]{margin:%?10?% 0;word-break:break-all;line-height:1.5;font-size:%?28?%;color:#444}.content uni-image[data-v-85db5e56]{width:100%}.btn-copy[data-v-85db5e56]{color:#409eff}.tools[data-v-85db5e56]{display:flex;align-items:center;justify-content:space-between;margin-top:%?12?%}.tools .btn[data-v-85db5e56]{font-size:%?32?%;color:#10a37f;display:flex;align-items:center;float:left;margin-right:%?10?%}.tools .btn[data-v-85db5e56]:active{opacity:.6}.tools .btn .icon[data-v-85db5e56]{width:%?32?%;height:%?32?%;margin-right:%?6?%}.btn-copy[data-v-85db5e56]{position:absolute;width:%?120?%;height:%?60?%;line-height:%?60?%;color:#10a37f;z-index:99;background:#fff;text-align:center;border-radius:%?10?%;font-size:%?28?%;box-shadow:0 0 %?20?% rgba(0,0,0,.2)}",""]),t.exports=e},f659:function(t,e,i){var a=i("ec86");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("0cc234a2",a,!0,{sourceMap:!1,shadowMode:!1})}}]);